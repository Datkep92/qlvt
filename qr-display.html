<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√¥ng Tin Thi·∫øt B·ªã Y T·∫ø</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f2f5;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
        }
        h1 { color: #2c3e50; margin-bottom: 10px; }
        .device-info { margin: 20px 0; }
        .info-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .label { width: 200px; font-weight: bold; color: #555; }
        .value { flex: 1; color: #333; }
        .no-data {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
            cursor: pointer;
        }
        .btn:hover { background: #0056b3; }
        .error { color: red; padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• TH√îNG TIN THI·∫æT B·ªä Y T·∫æ</h1>
            <p>B·ªánh vi·ªán Ninh Thu·∫≠n</p>
        </div>
        
        <div id="deviceData" class="device-info">
            <!-- Device info will be displayed here -->
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="window.print()" class="btn">üñ®Ô∏è In trang</button>
            <button onclick="window.history.back()" class="btn">‚Ü©Ô∏è Quay l·∫°i</button>
        </div>
    </div>

    <script>
        // TH√äM H√ÄM DEBUG V√ÄO ƒê·∫¶U SCRIPT
function debugHash() {
    console.log('=== DEBUG HASH INFO ===');
    console.log('Full URL:', window.location.href);
    console.log('Hash:', window.location.hash);
    console.log('Hash length:', window.location.hash.length);
    console.log('Hash content:', window.location.hash.substring(1));
    console.log('========================');
}

// S·ª¨A H√ÄM getDeviceDataFromHash
function getDeviceDataFromHash() {
    debugHash(); // Th√™m d√≤ng n√†y ƒë·ªÉ debug
    
    try {
        const hash = window.location.hash;
        
        if (!hash || hash === '#') {
            console.log('Empty hash, showing welcome page');
            return null;
        }
        
        // L·∫•y ph·∫ßn sau d·∫•u #
        const hashContent = hash.substring(1);
        console.log('Hash content to decode:', hashContent);
        
        if (!hashContent || hashContent.trim() === '') {
            console.log('Empty hash content');
            return null;
        }
        
        // Ki·ªÉm tra xem c√≥ ph·∫£i base64 kh√¥ng
        if (hashContent.length < 10) {
            console.log('Hash too short, not valid base64');
            return null;
        }
        
        // Th·ª≠ decode
        try {
            // S·ª≠ d·ª•ng c√°ch decode an to√†n
            const decoded = decodeURIComponent(escape(atob(hashContent)));
            console.log('Successfully decoded:', decoded.substring(0, 100) + '...');
            
            const device = JSON.parse(decoded);
            console.log('Parsed device:', device);
            
            return device;
            
        } catch (decodeError) {
            console.error('Decode error:', decodeError);
            
            // Th·ª≠ decode tr·ª±c ti·∫øp kh√¥ng qua escape (cho ƒë∆°n gi·∫£n)
            try {
                const decoded = atob(hashContent);
                console.log('Direct decode (no escape):', decoded);
                return JSON.parse(decoded);
            } catch (simpleError) {
                console.error('Simple decode also failed:', simpleError);
                return null;
            }
        }
        
    } catch (error) {
        console.error('Error in getDeviceDataFromHash:', error);
        return null;
    }
}
        function loadDeviceData() {
            const container = document.getElementById('deviceData');
            const hash = window.location.hash;
            
            console.log('Hash:', hash);
            
            if (!hash || hash === '#') {
                container.innerHTML = `
                    <div class="no-data">
                        <h3>üì± Qu√©t QR Code ƒë·ªÉ xem th√¥ng tin thi·∫øt b·ªã</h3>
                        <p>Vui l√≤ng qu√©t m√£ QR t·ª´ h·ªá th·ªëng qu·∫£n l√Ω thi·∫øt b·ªã</p>
                    </div>
                `;
                return;
            }
            
            try {
                // L·∫•y base64 t·ª´ hash (b·ªè d·∫•u #)
                const base64 = hash.substring(1);
                console.log('Base64:', base64);
                
                // Decode base64
                const jsonStr = atob(base64);
                console.log('JSON string:', jsonStr);
                
                // Parse JSON
                const device = JSON.parse(jsonStr);
                console.log('Device data:', device);
                
                // Hi·ªÉn th·ªã th√¥ng tin
                const html = `
                    <h2>${escapeHtml(device.name)}</h2>
                    <div class="info-row">
                        <div class="label">M√£ thi·∫øt b·ªã:</div>
                        <div class="value">${device.id}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">Model:</div>
                        <div class="value">${escapeHtml(device.model || 'N/A')}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">Nh√† s·∫£n xu·∫•t:</div>
                        <div class="value">${escapeHtml(device.manufacturer || 'N/A')}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">S·ªë l∆∞·ª£ng:</div>
                        <div class="value">${device.quantity} ${device.unit || 'c√°i'}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">T√¨nh tr·∫°ng:</div>
                        <div class="value">${device.status || 'N/A'}</div>
                    </div>
                    ${device.department ? `
                    <div class="info-row">
                        <div class="label">Ph√≤ng ban:</div>
                        <div class="value">${escapeHtml(device.department)}</div>
                    </div>
                    ` : ''}
                    ${device.note ? `
                    <div class="info-row">
                        <div class="label">Ghi ch√∫:</div>
                        <div class="value">${escapeHtml(device.note)}</div>
                    </div>
                    ` : ''}
                `;
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = `
                    <div class="error">
                        <h3>‚ùå L·ªói khi ƒë·ªçc th√¥ng tin</h3>
                        <p>QR Code kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n</p>
                        <p>L·ªói: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Ch·∫°y khi trang load
        window.addEventListener('load', loadDeviceData);
        window.addEventListener('hashchange', loadDeviceData);
        
        // Log ƒë·ªÉ debug
        console.log('QR Display Page Loaded');
        console.log('Test URL: https://datkep92.github.io/qlvt/qr-display.html#eyJpZCI6MSwibmFtZSI6Ik1heSB0aGlldCBiYSIsIm1vZGVsIjoiWDEwMCIsInF1YW50aXR5IjozLCJzdGF0dXMiOiJEYW5nIHN1IGR1bmcifQ==');
    </script>
</body>
</html>
